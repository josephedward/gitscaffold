# Gitscaffold — Shared Work Log and Plan (2025-10-05)

This document is the single coordination file for all agents.
- Agent A (Architecture & QA): testing, deduplication, core extraction, and release hardening.
- Agent B (CLI UX): main menu reorg, groups, help/README, and aliases/deprecations.
- Agent C (GitHub/gh Integrations): gh-powered Issues/PRs/Projects/Workflows coverage.

## Current Status
- Packaging fixed (pyproject.toml); CLI imports cleanly after syntax cleanup.
- core/config.py extracted; config group registered and usable.
- New group scaffolding added (settings, roadmap, issues, ci, source, api, demo, ai).
- gh-backed commands added:
  - issues: list, create, close
  - issues projects: list, view (requires `gh project`)
  - ci prs: list, view, comment, label-add, edit, merge

## Priorities
- Full GitHub/gh issue management first (list, view, create, edit, comment, label add/remove, close; sanitize/deduplicate/delete-closed; enrich).
- PR operations via gh under `ci prs`.
- Projects (kanban) via gh: list/view now; add CRUD next when available.

---

## Agent B — CLI UX Instructions (Authoritative)

Objective
- Make the new top-level groups the primary UX, deprecate legacy top-level commands, and keep help/README aligned.

Scope
- Files you own:
  - `scaffold/cli.py` (wiring/help text only — no business logic)
  - `scaffold/commands/*.py` (group definitions and thin wrappers)
  - `README.md` (usage, examples, migration)
- Do not edit: `scaffold/core/*` (Agent A) except to import functions into commands.

Tasks
1) Groups: ensure these exist and are visible with 1‑line descriptions
   - `settings`, `roadmap`, `issues`, `ci`, `source`, `api`, `demo`, `ai`
2) Settings group
   - `scaffold/commands/settings.py` hosts:
     - `settings config` (mounted from `commands/config_cmd.py`)
     - `settings setup`, `settings uninstall` (import from legacy for now)
     - Add a help stub for `settings doctor` (Agent C will implement)
3) Legacy compatibility
   - Keep legacy top-level commands available but print deprecation warnings pointing to the new group path.
   - Example: when user runs `gitscaffold sync`, print: "Deprecated: use `gitscaffold roadmap sync`".
4) Help polish
   - Update entry output: short, clear descriptions per group.
   - Ensure each group `--help` is tidy and alphabetized.
5) Documentation
   - Update README.md: new groups, examples, mapping table, and deprecation guidance.

Verification
- `gitscaffold` shows new groups as the recommended paths.
- Running legacy commands prints a deprecation notice and still works.
- README examples run cleanly.

---

## Agent C — GitHub/gh Integrations Instructions (Authoritative)

Objective
- Deliver comprehensive gh-powered workflows for Issues, PRs, Projects (kanban), and Workflows.

Scope
- Files you own:
  - `scaffold/github_cli.py` (extend gh wrappers)
  - `scaffold/commands/issues.py` (gh issue ops + projects)
  - `scaffold/commands/ci.py` (gh PR ops + workflows)
  - `scaffold/commands/ai.py` (`vibe` here; mark experimental)
- If gh lacks a feature, collaborate with Agent A to add GraphQL helpers to `core/github_client.py`.

Issues coverage (additions)
- `issues view` — show title/url/body via `gh issue view --json ...`
- `issues edit` — update body/title/labels/assignees
- `issues comment` — add a comment
- `issues label-remove` — remove labels
- Optional: `issues labels list|create|delete`, `issues milestones list|create|close`

Projects/Kanban
- Current: `issues projects list|view`
- Add (if supported by gh or via GraphQL):
  - `issues projects create`
  - `issues projects items add`
  - `issues projects items move`
  - Detect missing `gh project` and output guidance.

PRs (under `ci prs`)
- Current: `list|view|comment|label-add|edit|merge`
- Add: `label-remove`, `reviewers add/remove`, checks/status view, close/reopen.

Workflows (under `ci workflows`)
- Implement:
  - `ci workflows list` — workflows or runs (document which)
  - `ci workflows run <workflow.yml> [--ref BRANCH]`
  - `ci workflows status [--run-id ID]`
  - Use `gh workflow`/`gh run`; prefer JSON outputs.

Diagnostics
- Implement `settings doctor`:
  - Validate: `gh` found, `gh auth status` OK, GITHUB_TOKEN present; optional AI keys present.
  - Emit actionable next steps on failure.

Constraints
- Each command accepts `--repo` and defaults to `get_repo_from_git_config()`.
- Use `GitHubCLI` methods; extend that class where needed.
- No network/subprocess at import time; only inside commands.

Verification
- Smoke test list/view commands; graceful errors for auth/missing repo.
- Record example invocations in this doc.

## Immediate Deliverables (1–2 days)

- **Agent A**
    - Implement `core/cleanup.py` with plan/apply API and wire:
        - `issues sanitize`, `deduplicate`, `delete-closed` now call `core/cleanup`.
    - Remove duplicate `enrich*` blocks from `cli.py`; route to `core/ai.py` only.
    - Begin `core/diff.py` and wire `roadmap diff`.
- **Agent B**
    - Ensure top-level groups show as the canonical menu; add deprecation notes to legacy commands.
    - `settings` group: `commands/settings.py` including `config` + `uninstall/setup`.
    - Update `gitscaffold entry help` with one-line group descriptions.
    - `README`: new structure examples + mapping table.
- **Agent C**
    - `issues`: add `view/edit/comment/label-remove` and `milestones/labels` helpers.
    - `ci workflows`: `list/run/status` via gh.
    - `issues projects`: implement `create/item add/move` if gh plugin available; otherwise add GraphQL fallback.

## Next Actions by Agent

- **Agent A (Architecture & QA)**
  - Implement `core/cleanup.py` and wire issues sanitize/deduplicate/delete-closed/enrich.
  - Remove duplicate `_enrich_*` helpers; route via `core/ai.py`.
  - Extract `core/diff.py`, `core/sync.py` and wire `roadmap diff/sync`.
  - Migrate `github.py` to `core/github_client.py`; ensure CLI calls core only.
  - Run and triage tests; add unit tests for new core modules (no network).

- **Agent B (CLI UX)**
  - Ensure new groups are the primary interface; keep legacy aliases with deprecation.
  - Create `commands/settings.py` (config + install/uninstall/setup, later doctor).
  - Update entry help with short descriptions; update README with new groups and mapping.

- **Agent C (GitHub/gh Integrations)**
  - Issues: add `view`, `edit`, `comment`, `label-remove`; milestones/labels helpers.
  - CI workflows: `list`, `run`, `status` via gh.
  - Projects: add create/item add/move if `gh project` supports; fallback via GraphQL if needed.
  - Add `settings doctor` to validate gh presence/auth and tokens.

## Coordination and Handoffs

- **Shared log:** Use `work_2025-10-05.md` — add a per‑agent section (A/B/C) with:
    - Done / In Progress / Next
    - Commands added, usage examples, and any limitations
- **File boundaries to avoid conflicts:**
    - **Agent A:** `scaffold/core/*` and `tests`; minimal edits to commands to swap in core calls.
    - **Agent B:** `scaffold/cli.py` (wiring only), `scaffold/commands/*`, `README.md`, help copy.
    - **Agent C:** `scaffold/github_cli.py`, `scaffold/commands/issues.py`, `scaffold/commands/ci.py`, `scaffold/commands/ai.py` (vibe placement), plus any GraphQL utility added under `core/github_client.py` if needed.
- **Daily sync check:**
    - Verify no direct PyGithub/subprocess calls remain in commands; commands should call core or GitHubCLI consistently.
    - Record new commands and examples in `work_2025-10-05.md`.

## Acceptance Criteria
- New groups (settings/roadmap/issues/ci/source/api/demo/ai) are the main UX; legacy deprecations visible.
- gh coverage: issues, prs, and projects at parity for common workflows.
- Core isolation: cleanup/diff/sync in core; commands are thin wrappers.
- Tests pass locally without network.
