#!/usr/bin/env bash
set -euo pipefail

usage() {
  cat <<EOF
Usage: $(basename "$0") [-n COUNT] [-i INTERVAL] -- [codex args…]
  -n COUNT     number of times to run (default: infinite)
  -i INTERVAL  secs between runs (default: 20)
  [codex args] everything after “--” is passed straight to codex
EOF
  exit 1
}

COUNT=0
INTERVAL=20

while getopts ":n:i:" opt; do
  case $opt in
    n) COUNT=$OPTARG ;;
    i) INTERVAL=$OPTARG ;;
    *) usage ;;
  esac
done
shift $((OPTIND-1))

[[ $# -gt 0 ]] || usage

runs=0
while [[ $COUNT -eq 0 || $runs -lt $COUNT ]]; do
  codex "$@"
  runs=$((runs+1))
  if [[ $COUNT -ne 0 && $runs -ge $COUNT ]]; then
    break
  fi
  sleep "$INTERVAL"
done
